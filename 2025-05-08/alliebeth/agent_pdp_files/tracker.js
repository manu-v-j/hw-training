var adfenix=function(e){"use strict";var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t="undefined"!=typeof window?window:void 0!==u?u:"undefined"!=typeof self?self:{},o=function(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)},n=Object.prototype.toString;function s(e){return e.replace(/^\s+|\s+$/g,"")}var g=function(e){if(!e)return{};for(var t,n={},r=s(e).split("\n"),o=0;o<r.length;o++){var i=r[o],a=i.indexOf(":"),u=s(i.slice(0,a)).toLowerCase(),c=s(i.slice(a+1));void 0===n[u]?n[u]=c:(t=n[u],"[object Array]"===Object.prototype.toString.call(t)?n[u].push(c):n[u]=[n[u],c])}return n},i=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)a.call(n,r)&&(e[r]=n[r])}return e},a=Object.prototype.hasOwnProperty;var r=h,c=h;function d(e,t,n){var r=e;return o(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=i(t,{uri:e}),r.callback=n,r}function h(e,t,n){return l(t=d(e,t,n))}function l(r){if(void 0===r.callback)throw new Error("callback argument missing");var o=!1,i=function(e,t,n){o||(o=!0,r.callback(e,t,n))};function a(){var e=void 0;if(e=s.response?s.response:s.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(s),y)try{e=JSON.parse(e)}catch(e){}return e}function t(e){return clearTimeout(c),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,i(e,v)}function e(){if(!u){var e;clearTimeout(c),e=r.useXDR&&void 0===s.status?200:1223===s.status?204:s.status;var t=v,n=null;return 0!==e?(t={body:a(),statusCode:e,method:l,headers:{},url:d,rawRequest:s},s.getAllResponseHeaders&&(t.headers=g(s.getAllResponseHeaders()))):n=new Error("Internal XMLHttpRequest Error"),i(n,t,t.body)}}var n,u,c,s=r.xhr||null,d=(s=s||(r.cors||r.useXDR?new h.XDomainRequest:new h.XMLHttpRequest)).url=r.uri||r.url,l=s.method=r.method||"GET",p=r.body||r.data,f=s.headers=r.headers||{},m=!!r.sync,y=!1,v={body:void 0,headers:{},statusCode:0,method:l,url:d,rawRequest:s};if("json"in r&&!1!==r.json&&(y=!0,f.accept||f.Accept||(f.Accept="application/json"),"GET"!==l&&"HEAD"!==l&&(f["content-type"]||f["Content-Type"]||(f["Content-Type"]="application/json"),p=JSON.stringify(!0===r.json?p:r.json))),s.onreadystatechange=function(){4===s.readyState&&setTimeout(e,0)},s.onload=e,s.onerror=t,s.onprogress=function(){},s.onabort=function(){u=!0},s.ontimeout=t,s.open(l,d,!m,r.username,r.password),m||(s.withCredentials=!!r.withCredentials),!m&&0<r.timeout&&(c=setTimeout(function(){if(!u){u=!0,s.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",t(e)}},r.timeout)),s.setRequestHeader)for(n in f)f.hasOwnProperty(n)&&s.setRequestHeader(n,f[n]);else if(r.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(r.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in r&&(s.responseType=r.responseType),"beforeSend"in r&&"function"==typeof r.beforeSend&&r.beforeSend(s),s.send(p||null),s}h.XMLHttpRequest=t.XMLHttpRequest||function(){},h.XDomainRequest="withCredentials"in new h.XMLHttpRequest?h.XMLHttpRequest:t.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(r){h["delete"===r?"del":r]=function(e,t,n){return(t=d(e,t,n)).method=r.toUpperCase(),l(t)}}),r.default=c;var p=function(o){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return e},a=!1;return r(o,function(e,t,n){if(!a)if(200===t.statusCode)try{i(null,(r=n,{"application/json":function(e){return JSON.parse(e)},"text/plain":function(e){return e}}[o.headers["Content-Type"]](r)))}catch(e){i(e)}else i(e||new Error(t.statusCode));var r}),function(){a=!0}};var f,m={env:"production",SCRIPT_URL:"https://cdn.adfenix.com",TRACK_VISIT_URL:"https://api.sfnix.net/api/tracker",PROPERTY_IDENTIFIER_URL:"https://api.rlfrc.net/property-discovery/public/v1/property-visit/identifier",CONFIG_URL:"https://api.adfenix.com/AdFenix/GetScripts",TRACK_LEAD_URL:"https://api.adfenix.com/adfenix/tracklead"},y=!1,v=[],w=function e(t){if(t&&v.push(t),f&&clearTimeout(f),document.body){var n=document.querySelector(".hidden-fenix-tr-pixel");if(console.debug({buffer:v}),n||((n=new Image).className="hidden-fenix-tr-pixel",n.style.display="none",n.onerror=function(){y=!1,console.debug("error",v),clearTimeout(f),setTimeout(e,960)},n.onload=function(){y=!1,console.debug("load",v),clearTimeout(f),setTimeout(e,960)},document.body.appendChild(n)),!y&&0<v.length){var r=v.shift();console.debug({next:r,buffer:v}),y=!0,n.src=r,f=setTimeout(function(){y=!1,0<v.length&&e()},1e3)}return n}setTimeout(e,960)},b="af_utm",T="adfenix";function C(e){var o={};return e.split("?").pop().split("&").forEach(function(e){var t=e.split("="),n=t.shift(),r=t.join("=");o[n]=r}),o}function x(){var e={};try{var t=localStorage.getItem(b),n=JSON.parse(atob(t));Date.now()<n.expiry?e=n:localStorage.removeItem(b)}catch(e){console.debug("Corrupt raw data")}finally{return e}}function E(n){window.ga&&window.ga(function(e){if(e)e.send(n);else{var t=window.ga.getAll().shift();t&&t.send(n)}})}var O=Object.freeze({getQueries:C,saveUTMs:function(e){var t=C(window.location.search);if(t.utm_source===T)try{localStorage.setItem(b,btoa(JSON.stringify({expiry:e+7776e6,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign})))}catch(e){console.debug("Didn't save utms")}},postWidgetEventToGA:function(e){var t=x();return t.utm_source===T?E({hitType:"event",eventCategory:e,eventAction:"Adfenix: UTMEngage",eventLabel:"AdfenixTrackedUTMEngage",campaignSource:t.utm_source,campaignMedium:t.utm_medium,campaignName:t.utm_campaign}):E({hitType:"event",eventCategory:e,eventAction:"Adfenix: Engage",nonInteraction:!0})},postToGA:function(e){var t=x();if(t.utm_source===T)return E({hitType:"event",eventCategory:e,eventAction:"Adfenix: UTMConversion",eventLabel:"AdfenixTrackedConversion",campaignSource:t.utm_source,campaignMedium:t.utm_medium,campaignName:t.utm_campaign})},getCorrectUrl:function(e,t){if(["google","ecosia","bing","yahoo","ask","aol","baidu","wolframalpha","duckduckgo","yandex.ru"].some(function(e){return-1!==t.hostname.indexOf(e)}))throw new Error("Error");return e.href,t.href,t.href},isEmailOrPhoneValid:function(e){var t=e.email,n=e.phone,r=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test((t+"").toLowerCase()),o=n&&0<n.length&&/^[^a-zA-Z]+$/.test(n);return r||o},uuidv4:function(){var t=window.crypto||window.msCrypto;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(e){return(e^t.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})}}),R=p,I=!1,L=O.saveUTMs,A=function(){if(!I)return function(){var e=encodeURIComponent(window.location.href);return new Promise(function(r){R({method:"GET",uri:"".concat(m.PROPERTY_IDENTIFIER_URL,"?url=").concat(e),headers:{"Content-Type":"text/plain"}},function(e,t){if(e)return r(void 0);try{if(!t)return r(void 0);var n=new RegExp(t,"g").exec(document.documentElement.innerHTML);return n&&n[1]?r(n[1]):r(void 0)}catch(e){return r(void 0)}})})}().then(function(e){return w(function(e){var t=encodeURIComponent(window.location.href),n=encodeURIComponent(document.referrer),r=Date.now();L(r),I=!0;var o="".concat(m.TRACK_VISIT_URL,"?url=").concat(t,"&source=").concat(n,"&time=").concat(r);return e?"".concat(o,"&uniqueIdentifier=").concat(encodeURIComponent(e)):o}(e))})};function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function j(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?S(Object(i),!0).forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})}return o}function _(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Date.now||(Date.now=function(){return(new Date).getTime()});var P="data-adfenix",M={};function k(t){return function(e){M[t]=e.target.value}}function U(n){if(!n)return D=!0;var e=n.map(function(e){var t=document.querySelector("".concat(e.inputId));return t&&(M[e.inputType]=t.value),t}).filter(function(e){return e});e.length!==n.length||(D=!0,e.map(function(e,t){return e.addEventListener("input",k(n[t]))}))}var D=!1,q={attributes:!0,childList:!0,subtree:!0},H=new MutationObserver(function(e,t){var n=N();D?t.disconnect():U(n)}),N=function(){var e={andrewsonline:[{inputType:"name",inputId:"#stb_form_name"},{inputType:"email",inputId:"#stb_form_email"},{inputType:"phone",inputId:"#stb_form_telephone"},{inputType:"name",inputId:"#reapit-viewing-initials"},{inputType:"phone",inputId:"#reapit-viewing-phone"}],erikolsson:[{inputType:"name",inputId:"#Name.valid"},{inputType:"email",inputId:"#Email.valid"},{inputType:"phone",inputId:"#Phone.valid"}]};return e[Object.keys(e).find(function(e){return-1!==window.location.host.indexOf(e)})]};var X={attachListenersToInputFields:function(){function t(){_(document.querySelectorAll("[".concat(P,"]"))).map(function(e){return e.addEventListener("input",k(e.getAttribute(P)))}),D=!1}var e=document.querySelector("body"),n=N();document.addEventListener("readystatechange",function(){"complete"===document.readyState&&(H.observe(e,q),n?U(n):t())});var r=["kuperrealty"].some(function(e){return-1!==window.location.hostname.indexOf(e)}),o=new MutationObserver(function(e){e.forEach(function(e){"childList"==e.type&&t()})});r?o.observe(e,q):o.disconnect()},getInputData:function(){return j({},M)}},G=function(){},z=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof e)return e(J);var n=O.uuidv4(),r=w(Z({event:e,payload:t,guid:n}));return O.postToGA(e),window.openTypeform&&function(e,t){var n=X.getInputData();n.guid=t,console.debug("shouldAnswer",F),!F||O.isEmailOrPhoneValid(n)&&window.openTypeform&&window.openTypeform({event:e,data:n})}(e,n),r};var F=!1;function V(e){var t=Date.now(),n=e.data||{type:""};if("getItem"!==n.type){if("storage"===n.type){var r=n.newValue||0;return console.debug("debug",n),F=0<t-r,void console.debug("new shouldAnswer",F)}}else F=0<t-n.data}function J(e){var t=e.widgetEvent,n=e.conversionEvent,r=void 0===n?"":n,o=O.uuidv4();return r&&w(Z({event:r,guid:o})),O.postWidgetEventToGA(t)}function Z(e){var t=e.event,n=e.payload,r=void 0===n?{}:n,o=e.guid;try{var i=O.getCorrectUrl(window.top.location,window.parent.location),a=JSON.stringify({Url:i,LeadSource:t.toLowerCase(),Message:JSON.stringify(r),Source:window.document.referrer.substring(0,100),Guid:o});return"".concat(m.TRACK_LEAD_URL,"?json=").concat(encodeURIComponent(a))}catch(e){return console.debug(e),""}}function W(e){if(!document.getElementById("realforce-overlay-modal")){var t=e||{},n=t.buttonColor,r=void 0===n?"rgb(37, 82, 236)":n,o=t.backgroundColor,i=void 0===o?"black":o,a=t.buttonText,u=void 0===a?"Okej":a,c=t.description,s=void 0===c?"Bostaden granskas utav säljaren, du kan se bostaden men information kan ändras.":c,d=t.title,l=void 0===d?"Förhandsgranskning pågår":d,p=t.zIndex,f=void 0===p?2147483648:p,m=t.enabled;if(void 0===m||!m)if("true"!==new URLSearchParams(window.location.search).get("realforceOverlay"))return;var y=document.createElement("div");y.style.position="fixed",y.style.top=0,y.style.left=0,y.style.width="100%",y.style.height="100%",y.style["z-index"]=f,y.style.background=i,y.style.opacity=.25;var v=document.createElement("div");v.style.position="fixed",v.style.top="50%",v.style.left="50%",v.style.transform="translate(-50%, -50%)",v.style.width="300px",v.style.background="white",v.style.borderRadius="5px",v.style["z-index"]=f+1,v.style.setProperty("padding","5px","important"),v.id="realforce-overlay-modal";var g=document.createElement("div");g.style.display="flex",g.style.flexDirection="row",g.style.alignItems="center",g.style.columnGap="8px";var h=document.createElement("p");h.innerText=l,h.style.fontWeight=600,h.style.setProperty("margin",0,"important"),h.style.setProperty("padding",0,"important"),h.style.setProperty("font-size","14px","important");var w=document.createElementNS("http://www.w3.org/2000/svg","svg");w.setAttribute("height","1em"),w.setAttribute("viewBox","0 0 24 24"),w.style.fill=r,w.style.opacity="0.5",w.innerHTML='<path fill-rule="evenodd" clip-rule="evenodd" d="M5.25 10.5C8.1495 10.5 10.5 8.1495 10.5 5.25C10.5 2.35051 8.1495 0 5.25 0C2.35051 0 0 2.35051 0 5.25C0 8.1495 2.35051 10.5 5.25 10.5ZM5.25 2.25C4.83579 2.25 4.5 2.58579 4.5 3V5.25C4.5 5.66421 4.83579 6 5.25 6C5.66421 6 6 5.66421 6 5.25V3C6 2.58579 5.66421 2.25 5.25 2.25ZM4.5 7.5C4.5 7.08579 4.83579 6.75 5.25 6.75C5.66421 6.75 6 7.08579 6 7.5C6 7.91421 5.66421 8.25 5.25 8.25C4.83579 8.25 4.5 7.91421 4.5 7.5ZM6 15C6 13.9006 6.19712 12.8473 6.55795 11.8734C9.23676 11.3474 11.3474 9.23676 11.8734 6.55795C12.8473 6.19712 13.9006 6 15 6C19.9706 6 24 10.0294 24 15C24 19.9706 19.9706 24 15 24C10.0294 24 6 19.9706 6 15ZM15 9C14.5858 9 14.25 9.33579 14.25 9.75V15.75C14.25 16.1642 14.5858 16.5 15 16.5H20.25C20.6642 16.5 21 16.1642 21 15.75C21 15.3358 20.6642 15 20.25 15H15.75V9.75C15.75 9.33579 15.4142 9 15 9Z"/>',g.appendChild(w),g.appendChild(h);var b=document.createElement("p");b.innerText=s,b.style.setProperty("margin",0,"important"),b.style.setProperty("padding","6px 0","important"),b.style.setProperty("font-size","14px","important");var T=document.createElement("button");T.innerText=u,T.style.background=r,T.style.color="white",T.style.borderRadius="5px",T.style.width="100%",T.style.border="none",T.style.setProperty("padding","7px","important"),T.style.cursor="pointer",T.style.setProperty("font-size","14px","important"),T.onclick=function(){document.body.removeChild(y),document.body.removeChild(v)};var C=document.createElement("div");C.style.setProperty("padding","6px 10px","important"),C.appendChild(g),C.appendChild(b),v.appendChild(C),v.appendChild(T),document.body.appendChild(y),document.body.appendChild(v)}}!function e(){if(document.body){var t="sessionAccessId-tracker";window.addEventListener("message",V);var n=document.createElement("iframe");n.src="https://assets.adfenix.com/html/server.html",n.style.width=0,n.style.height=0,n.style.display="none",n.onload=function(){n.contentWindow.postMessage({method:"connect",id:t},"https://assets.adfenix.com/html/server.html"),n.contentWindow.postMessage({method:"getItem",key:location.host,id:t},"https://assets.adfenix.com/html/server.html")},document.body.appendChild(n)}else setTimeout(e,16)}(),window.realforceOverlay=W;var K=p,B=A,$={renderOverlay:W}.renderOverlay,Y=Q;function Q(){var e={url:window.location.href,source:document.referrer};K({method:"POST",uri:m.CONFIG_URL,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},function(e,t){return e?void console.debug("err ",e):void t.scripts.map(function(e){return ee(e,t.listingDetails)})})}function ee(e,t){try{var n=(a=e.name.toLowerCase(),"hqtest.adfenix.com"===window.location.host&&-1<window.location.href.indexOf("staging")&&"engage"===a?{name:a,url:"".concat(m.SCRIPT_URL,"/").concat(a,"-staging.js")}:{name:a,url:"".concat(m.SCRIPT_URL,"/").concat(a,".js")}),r=n.name,o=n.url;if(u[r])throw 0;if("overlay"===r)return void $(e.configs);if(!o)return console.error("script needs an 'Url' prop");u[r]=u[r]||(u[r]=[]);var i=document.createElement("script");document.body.appendChild(i),i.onload=function(){console.debug("Success loading:",r)},i.onerror=function(){console.debug("Failed loading:",r)},i.type="text/javascript",i.async=!0,i.src=o,u[r].push(j({},e,{listingDetails:t}))}catch(e){console.debug("error ",e)}var a}!function e(){var t,n=document.location.pathname,r=document.querySelector("body");if(!r)return setTimeout(e,960);new MutationObserver(function(){var e=document.location.pathname;e!==n&&(t&&t(),n=e,B(),t=Q())}).observe(r,{childList:!0,subtree:!0})}();var te=A,ne=G,re=z,oe=Y,ie=X.attachListenersToInputFields;te(),oe(),ie();var ae={init:ne,track:re},ue=ae.init,ce=ae.track;return e.default=ae,e.init=ue,e.track=ce,e}({});
